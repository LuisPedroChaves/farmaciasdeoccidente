<div fxFlex fxLayout="column" class="section-content">
    <mat-progress-bar mode="query" *ngIf="loading"></mat-progress-bar>
    <header class="module-header section" fxLayout="row wrap">
        <button mat-icon-button class="close-button" [routerLink]="'/purchase'">
      <mat-icon>close</mat-icon>
    </button>
        <h2 color="accent" class="ma-0 info-row T">Factura #{{ form.get('noBill').value }}</h2>
        <div fxFlex></div>
        <h2 class="ma-0 info-row">{{ form.get('_provider').value ? form.get('_provider').value.name : '' }}</h2>
        <br>
    </header>
    <div fxLayout="row" class="totalP">
        <div fxFlex></div>
        <p>
            <span *ngIf="form.get('created').value">
        {{  form.get('created').value | date: 'dd/MM/yyyy HH:mm' }}
      </span> - {{ form.get('_user').value ? form.get('_user').value.name : '' }}</p>
    </div>
    <div fxLayout="column" class="totalP">
        <form [formGroup]="form" autocomplete="off">
            <div class="card mat-elevation-z2 my-container" data-simplebar>
                <div class="detail-container" data-simplebar>
                    <table mat-table [dataSource]="dataSource" formArrayName="detail">

                        <ng-container matColumnDef="presentation">
                            <th mat-header-cell *matHeaderCellDef> present. </th>
                            <td mat-cell *matCellDef="let row; let index = index" [formGroupName]="index">
                                {{ detailForm.at(index).get('presentation').value.name }}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="_product">
                            <th mat-header-cell *matHeaderCellDef> Producto </th>
                            <td mat-cell *matCellDef="let row; let index = index" [formGroupName]="index">
                                {{ detailForm.at(index).get('_product').value.description}}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="lote">
                            <th mat-header-cell *matHeaderCellDef> Lote </th>
                            <td mat-cell *matCellDef="let row; let index = index" [formGroupName]="index">
                                #324
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="quantity">
                            <th mat-header-cell *matHeaderCellDef> Cantidad </th>
                            <td mat-cell *matCellDef="let row; let index = index" [formGroupName]="index">
                                {{ detailForm.at(index).get('quantity').value}}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="cost">
                            <th mat-header-cell *matHeaderCellDef> Costo Unitario (Q) </th>
                            <td mat-cell *matCellDef="let row; let index = index" [formGroupName]="index">
                                {{ detailForm.at(index).get('cost').value | number: '.2' }}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="expirationDate">
                            <th mat-header-cell *matHeaderCellDef> Fecha de vencimiento </th>
                            <td mat-cell *matCellDef="let row; let index = index" [formGroupName]="index">
                                {{ detailForm.at(index).get('expirationDate').value}}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="stock">
                            <th mat-header-cell *matHeaderCellDef> Existencia </th>
                            <td mat-cell *matCellDef="let row; let index = index" [formGroupName]="index">
                                500
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="realQuantity">
                            <th mat-header-cell *matHeaderCellDef> Cant. Tickets </th>
                            <td mat-cell *matCellDef="let row; let index = index" [formGroupName]="index">
                                <mat-form-field appearance="outline" color="primary" class="inputWidth">
                                    <input matInput formControlName="realQuantity" type="number" placeholder="0" aria-label="Number">
                                </mat-form-field>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="options">
                            <th mat-header-cell *matHeaderCellDef> Imprimir </th>
                            <td mat-cell *matCellDef="let row; let index = index" [formGroupName]="index">
                                <button mat-mini-fab color="warn">
                                    <mat-icon>print</mat-icon>
                                  </button>
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="displayedColumns;  sticky: true"></tr>
                        <tr mat-row *matRowDef="let row; let i = index; columns: displayedColumns;"></tr>
                    </table>

                </div>
                <div class="section" fxLayout="row wrap">
                    <div fxFlex="100" fxLayoutAlign="center center" fxLayout="row wrap">
                        <h3 class="product-font ma-0">Cantidad: {{ detailForm.length }}</h3>
                        <span fxFlex></span>
                        <mat-progress-spinner *ngIf="loading" mode="indeterminate" diameter="30" color="warn">
                        </mat-progress-spinner>
                        <span fxFlex></span>
                        <h2 class="product-font ma-0">TOTAL: Q. {{ getTotal() | number: '.2' }}</h2>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>