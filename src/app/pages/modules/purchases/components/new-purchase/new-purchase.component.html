<div fxFlex fxLayout="column" class="section-content">
    <header class="module-header section" fxLayout="row wrap">
        <button mat-icon-button class="close-button" [routerLink]="'/purchases'">
      <mat-icon>close</mat-icon>
    </button>
        <h2 color="accent" class="ma-0 info-row T">Nueva factura</h2>
        <div fxFlex></div>
        <button mat-raised-button color="accent" class="close-button">
      <mat-icon>add</mat-icon>PRODUCTO
    </button>
        <button mat-raised-button color="accent">
      <mat-icon>add</mat-icon>PROVEEDOR
    </button>
    </header>
    <div fxFlex fxLayout="row">
        <div fxFlex="25%" fxFlex.xs="100%" class="section">
            <div class="card mat-elevation-z2">
                <div class="section" fxLayout="row wrap">
                    <h2 color="primary" class="product-font ma-0">Encabezado</h2>
                </div>
                <from [formGroup]="formPurchase" autocomplete="off">
                    <div fxLayout="row">
                        <div fxFlex></div>
                        <div fxFlex="50" class="inputpadding">
                            <mat-form-field appearance="outline" color="primary" class="width-all">
                                <mat-label>Fecha</mat-label>
                                <input matInput [matDatepicker]="picker" formControlName="date">
                                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                <mat-datepicker #picker></mat-datepicker>
                            </mat-form-field>
                        </div>
                        <div fxFlex="20px"></div>
                    </div>
                    <div fxLayout="row">
                        <div fxFlex="20px"></div>
                        <div fxFlex="50px" fxHide.xs fxLayoutAlign="center center">
                            <mat-icon color="accent" class="material-icons-outlined">business
                            </mat-icon>
                        </div>
                        <div fxFlex class="inputpadding">
                            <mat-form-field color="primary" class="width-all" appearance="outline">
                                <mat-label>Proveedor</mat-label>
                                <mat-select formControlName="_provider">
                                    <mat-option *ngFor="let provider of providers" [value]="provider._id">{{ provider.name }}</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                        <div fxFlex="20px"></div>
                    </div>
                    <div fxLayout="row">
                        <div fxFlex="20px"></div>
                        <div fxFlex="50px" fxHide.xs fxLayoutAlign="center center">
                            <mat-icon color="accent" class="material-icons-outlined">summarize
                            </mat-icon>
                        </div>
                        <div fxFlex class="inputpadding">
                            <mat-form-field appearance="outline" color="primary" class="width-all">
                                <mat-label>Factura</mat-label>
                                <input formControlName="noBill" type="text" matInput placeholder="Ingrese el No. de factura">
                            </mat-form-field>
                        </div>
                        <div fxFlex="20px"></div>
                    </div>
                    <div fxLayout="row">
                        <div fxFlex="20px"></div>
                        <div fxFlex="50px" fxHide.xs fxLayoutAlign="center center">
                            <mat-icon color="accent" class="material-icons-outlined">tag
                            </mat-icon>
                        </div>
                        <div fxFlex class="inputpadding">
                            <mat-form-field appearance="outline" color="primary" class="width-all">
                                <mat-label>Requicisión</mat-label>
                                <input formControlName="requisition" type="text" matInput placeholder="Ingrese el No. de requicisión">
                            </mat-form-field>
                        </div>
                        <div fxFlex="20px"></div>
                    </div>
                    <div fxLayout="row">
                        <div fxFlex="20px"></div>
                        <div fxFlex="50px" fxHide.xs fxLayoutAlign="center center">
                            <mat-icon color="accent" class="material-icons-outlined">payment
                            </mat-icon>
                        </div>
                        <div fxFlex class="inputpadding">
                            <mat-button-toggle-group formControlName="payment">
                                <mat-button-toggle value="CONTADO">Contado</mat-button-toggle>
                                <mat-button-toggle value="CREDITO">Crédito</mat-button-toggle>
                            </mat-button-toggle-group>
                        </div>
                        <div fxFlex="20px"></div>
                    </div>
                    <br>
                    <mat-divider class=""></mat-divider>
                    <br>
                    <div fxLayout="row">
                        <div fxFlex="20px"></div>
                        <div fxFlex="50px" fxHide.xs fxLayoutAlign="center center">
                            <mat-icon color="accent" class="material-icons-outlined">info
                            </mat-icon>
                        </div>
                        <div fxFlex class="inputpadding">
                            <mat-form-field appearance="outline" color="primary" class="width-all">
                                <mat-label>Detalles</mat-label>
                                <textarea formControlName="details" matInput rows="6" cols="75" placeholder="Observaciones..."></textarea>
                            </mat-form-field>
                        </div>
                        <div fxFlex="20px"></div>
                    </div>
                    <div fxLayout="row">
                        <div fxFlex="20px"></div>
                        <div fxFlex="50px" fxHide.xs fxLayoutAlign="center center">
                            <mat-icon color="accent" class="material-icons-outlined">attach_file
                            </mat-icon>
                        </div>
                        <div fxFlex class="inputpadding">
                            <mat-form-field appearance="outline" class="width-all">
                                <mat-label>
                                    Archivo
                                </mat-label>
                                <ngx-mat-file-input #removableInput formControlName="file" placeholder="Ingrese un archivo">
                                </ngx-mat-file-input>
                                <button mat-icon-button matSuffix *ngIf="!removableInput.empty" (click)="removableInput.clear($event)">
                  <mat-icon>clear</mat-icon>
                </button>
                            </mat-form-field>
                        </div>
                        <div fxFlex="20px"></div>
                    </div>
                </from>
            </div>
        </div>
        <div fxFlex fxFlex.xs="100%" class="section">
            <div class="card mat-elevation-z2 my-container" data-simplebar>
                <div class="section" fxLayout="row wrap">
                    <h2 color="primary" class="product-font ma-0">Detalle de la factura</h2>
                    <mat-form-field appearance="outline" color="warn" class="width-all">
                        <input matInput placeholder="Buscar producto..." aria-label="State" [matAutocomplete]="auto" [formControl]="searchMoviesCtrl">
                        <mat-autocomplete #auto="matAutocomplete">
                            <mat-option *ngIf="isLoading" class="is-loading">Loading...</mat-option>
                            <ng-container *ngIf="!isLoading">
                                <mat-option *ngFor="let movie of filteredMovies" [value]="movie.Title">
                                    <span><b>{{movie.code}}</b> ({{movie.description}})</span>
                                </mat-option>
                            </ng-container>
                        </mat-autocomplete>
                    </mat-form-field>

                    <br>

                    <ng-container *ngIf="errorMsg; else elseTemplate">
                        {{errorMsg}}
                    </ng-container>
                    <ng-template #elseTemplate>
                        <h5>Selected Value: {{searchMoviesCtrl.value}}</h5>
                    </ng-template>
                    <!-- <mat-form-field appearance="outline" color="warn" class="width-all">
            <mat-label>Buscar producto</mat-label>
            <input type="text" (ngModelChange)="addRow($event)" placeholder="Buscar producto..." aria-label="Number"
              matInput [matAutocomplete]="auto">
            <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete">
              <mat-option *ngFor="let option of filteredOptions | async" [value]="option.nit">
                <span>{{option.nit}}</span> |
                <small class="mat-text-muted">{{option.name}}</small>
              </mat-option>
            </mat-autocomplete>
          </mat-form-field> -->
                </div>
                <div class="section" fxLayout="row wrap">
                    <div class="header" fxFlex="100" fxLayout="row wrap">
                        <div fxFlex="9" class="ellipsis-text cell header-cell">Cantidad</div>
                        <div fxFlex class="ellipsis-text cell header-cell">Producto</div>
                        <div fxFlex="9" class="ellipsis-text cell header-cell">Precio Unitario (Q)</div>
                        <div fxFlex="9" class="ellipsis-text cell header-cell">Bono</div>
                        <div fxFlex="9" class="ellipsis-text cell header-cell">Descuento (%)</div>
                        <div fxFlex="9" class="ellipsis-text cell header-cell">Total (Q)</div>
                        <div fxFlex="9" class="ellipsis-text cell header-cell">Costo Unitario (Q)</div>
                        <div fxFlex="9" class="ellipsis-text cell header-cell">Cantidad Real</div>
                        <div fxFlex="9" class="ellipsis-text cell header-cell">Fecha de vencimiento</div>
                        <div fxFlex="nogrow" class="ellipsis-text cell header-cell">
                            <mat-icon class="material-icons-outlined cursor-pointer">cancel</mat-icon>
                        </div>
                    </div>
                    <div fxFlex="100" fxLayout="row wrap" *ngIf="detailPurchase.length > 0">
                        <div class="row" *ngFor="let p of detailPurchase; let i = index" fxFlex="100" fxLayoutAlign="start center" fxLayout="row wrap">
                            <div fxFlex="9" class="cell">
                                <input type="number" [(ngModel)]="p.quantity" [ngModelOptions]="{standalone: true}" class="cantinput">
                            </div>
                            <div fxFlex class="ellipsis-text cell">{{p._product.name}}</div>
                            <div fxFlex="9" class=" cell"><input type="number" [(ngModel)]="p.price" [ngModelOptions]="{standalone: true}" class="cantinput"></div>
                            <div fxFlex="9" class=" cell"><input type="number" [(ngModel)]="p.bono" [ngModelOptions]="{standalone: true}" class="cantinput"></div>
                            <div fxFlex="9" class=" cell"><input type="number" [(ngModel)]="p.discount" [ngModelOptions]="{standalone: true}" class="cantinput"></div>
                            <div fxFlex="9" class="ellipsis-text cell"><b>{{p.quantity * p.price | number: '.2'}}</b></div>
                            <div fxFlex="9" class="ellipsis-text cell">{{p.cost | number: '.2'}}</div>
                            <div fxFlex="9" class=" cell"><input type="number" [(ngModel)]="p.realQuantity" [ngModelOptions]="{standalone: true}" class="cantinput"></div>
                            <div fxFlex="9" class=" cell"><input type="text" [(ngModel)]="p.expirationDate" [ngModelOptions]="{standalone: true}" class="cantinput"></div>
                            <div fxFlex="nogrow" class="ellipsis-text cell">
                                <mat-icon (click)="remove(i)" class="material-icons-outlined cursor-pointer">cancel</mat-icon>
                            </div>
                        </div>
                    </div>
                    <div fxFlex="100" fxLayout="column wrap" class="noproducts" fxLayoutAlign="center center" *ngIf="detailPurchase.length <= 0">
                        <span>No hay productos agregados</span>
                        <span class="text-muted">Agregue productos de la lista</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div fxLayout="row">
        <div fxFlex class="totalP">
            <div class="card mat-elevation-z4">
                <div class="section" fxLayout="row wrap">
                    <div fxFlex="100" fxLayout="row wrap">
                        <div fxFlex="100" fxLayoutAlign="start center" fxLayout="row wrap">
                            <button mat-raised-button class="close-button" style="color:brown;">
                CANCELAR
              </button>
                            <button mat-raised-button [disabled]="formPurchase.invalid || detailPurchase.length === 0" color="primary" class="close-button">
                CREAR
              </button>
                            <button mat-raised-button [disabled]="formPurchase.invalid || detailPurchase.length === 0" color="warn" class="close-button">
                APLICAR
              </button>
                            <span fxFlex></span>
                            <h1 class="product-font ma-0">TOTAL: Q. {{ getTotal() | number: '.2' }}</h1>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>